import{M as k,T as L}from"./bootstrap.esm-l9cKv-78.js";import{p as M}from"./PaginationMode-C6L4IfDp.js";import{_ as T,c as a,b as v,a as t,F as _,v as m,u as o,y as u,z as w,B as x,r as I,o as n}from"./index-XKhyKIYG.js";var E={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"peggy123",VITE_TEXT:"這是部署的環境",BASE_URL:"/Raiko/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:b,VITE_PATH:g}=E;let y=null,f=null,h=null;const V={data(){return{orders:[],totalPage:"",currentPage:1,perpage:10,tempItem:{},toastTitle:"",toastContent:"",isLoading:!0,fallPage:!1}},components:{pagination:M},methods:{getData(d=1){const l=`${b}/api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.$http.get(l).then(c=>{this.orders=c.data.orders,this.totalPage=c.data.pagination.total_pages}).catch(c=>{this.toastTitle="取得訂單",this.toastContent=c.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},updatePaid(d){const l=`${b}/api/${g}/admin/order/${d.id}`,c={is_paid:d.is_paid};this.isLoading=!0,this.$http.put(l,{data:c}).then(p=>{console.log(p),y.hide(),this.toastTitle="更新付款狀態",this.toastContent="訂單狀態已更新成功",h.show()}).catch(p=>{this.toastContent=p.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},openModal(d,l){this.tempItem=d,l==="edit"?y.show():l==="delete"&&f.show()},deleteOrder(){const d=`${b}/api/${g}/admin/order/${this.tempItem.id}`;this.isLoading=!0,this.$http.delete(d).then(l=>{f.hide(),this.getData(),this.toastTitle="更新訂單",this.toastContent="訂單已成功刪除",h.show()}).catch(l=>{this.toastContent=l.response.data.message,h.show()}).finally(()=>{this.isLoading=!1})},swichPage(d){this.currentPage=d}},computed:{totalPage(){return Math.ceil(this.orders.length/this.perpage)}},mounted(){const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=d,y=new k(document.getElementById("orderModal"),{keyboard:!1}),f=new k(document.getElementById("deleteModal"),{keyboard:!1}),h=new L(document.getElementById("toast")),this.getData()}},D={class:"container"},B=t("h2",{class:"py-8 mb-0"},"訂單管理",-1),S={class:"row"},U={class:"table align-middle text-center table-striped"},O=t("thead",null,[t("tr",{class:"table-dark"},[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col",width:"250"},"Email"),t("th",{scope:"col",width:"250"},"購買品項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"}),t("th",{scope:"col"})])],-1),R={key:0},A={scope:"row"},N={key:"product.id",class:"ps-0 mb-0 list-unstyled"},j={class:"mb-2 d-flex"},q=["src"],z={class:"d-flex align-items-center justify-content-between flex-grow-1"},F={class:"text-dark text-start"},H={class:"form-check form-switch"},X=["onUpdate:modelValue","onChange"],G={class:"form-check-label"},J={key:0,class:"text-success fw-bold"},K={key:1,class:"text-secondary"},Q=["onClick"],W=t("i",{class:"bi bi-eye-fill me-2"},null,-1),Y=t("span",null,"檢視",-1),Z=[W,Y],$=["onClick"],tt=t("i",{class:"bi bi-x-lg"},null,-1),et=[tt],st={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ot={class:"modal-dialog modal-lg"},lt={class:"modal-content"},at=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單詳細資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),nt={class:"modal-body"},dt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂單內容",-1),it={key:0,class:"table mb-10"},ct=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"下單日期"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"},"總金額")])],-1),rt={scope:"row"},ht={key:0,class:"fw-bold text-success"},_t={key:1,class:"text-secondary"},pt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"購買商品",-1),ut={key:1,class:"table mb-10 align-middle"},mt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額")])],-1),bt={scope:"row"},gt=["src"],yt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂購人資訊",-1),ft={key:2,class:"table"},kt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"姓名"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"電話"),t("th",{scope:"col"},"地址")])],-1),vt={scope:"row"},wt={class:"form-check d-flex justify-content-end"},xt=t("label",{for:"paid"},"已付款",-1),It={class:"modal-footer"},Pt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Ct={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Lt={class:"modal-dialog modal-dialog-centered"},Mt={class:"modal-content"},Tt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Et=t("div",{class:"modal-body"},[t("p",null,"是否確定刪除此訂單(刪除後將無法恢復)")],-1),Vt={class:"modal-footer"},Dt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Bt={id:"toast",class:"toast hide toast-container position-fixed toast-placement",role:"alert","aria-live":"assertive","aria-atomic":"true"},St={class:"toast-header mb-0"},Ut={class:"me-auto"},Ot=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close"},null,-1),Rt={class:"toast-body"};function At(d,l,c,p,s,r){const P=I("VueLoading"),C=I("pagination");return n(),a(_,null,[v(P,{active:s.isLoading},null,8,["active"]),t("div",D,[B,t("div",S,[t("table",U,[O,t("tbody",null,[(n(!0),a(_,null,m(s.orders,e=>(n(),a(_,{key:e.id},[s.orders.length?(n(),a("tr",R,[t("td",A,o(new Date(e.create_at*1e3).toLocaleDateString()),1),t("td",null,o(e.user.email),1),t("td",null,[(n(!0),a(_,null,m(e.products,i=>(n(),a("ul",N,[t("li",j,[t("img",{src:i.product.imageUrl,alt:"product.product.title",width:"50",class:"me-2 rounded"},null,8,q),t("div",z,[t("div",null,o(i.product.title),1),t("div",F,o(i.qty+i.product.unit),1)])])]))),128))]),t("td",null,o(e.total)+" 元",1),t("td",null,[t("div",H,[w(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>r.updatePaid(e)},null,40,X),[[x,e.is_paid]]),t("label",G,[e.is_paid?(n(),a("span",J,"已付款")):(n(),a("span",K,"未付款"))])])]),t("td",null,[t("button",{type:"button",class:"btn btn-dark btn-sm",onClick:i=>r.openModal(e,"edit")},Z,8,Q)]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>r.openModal(e,"delete")},et,8,$)])])):u("",!0)],64))),128))])])])]),v(C,{"total-Page":r.totalPage,"current-Page":s.currentPage,onSwichPage:d.switchPage,class:"my-15"},null,8,["total-Page","current-Page","onSwichPage"]),t("div",st,[t("div",ot,[t("div",lt,[at,t("div",nt,[dt,s.tempItem?(n(),a("table",it,[ct,t("tbody",null,[t("tr",null,[t("th",rt,o(s.tempItem.id),1),t("td",null,o(new Date(s.tempItem.create_at*1e3).toLocaleDateString()),1),t("td",null,[s.tempItem.is_paid?(n(),a("span",ht,"已付款")):(n(),a("span",_t,"尚未付款"))]),t("td",null,o(s.tempItem.total),1)])])])):u("",!0),pt,s.tempItem?(n(),a("table",ut,[mt,t("tbody",null,[(n(!0),a(_,null,m(s.tempItem.products,e=>(n(),a("tr",{key:e.id},[t("td",bt,o(e.product.title),1),t("td",null,[t("img",{src:e.product.imageUrl,alt:"product.product.title",width:"100"},null,8,gt)]),t("td",null,o(e.qty),1),t("td",null,o(e.total),1)]))),128))])])):u("",!0),yt,s.tempItem.user?(n(),a("table",ft,[kt,t("tbody",null,[t("tr",null,[t("td",vt,o(s.tempItem.user.name),1),t("td",null,o(s.tempItem.user.email),1),t("td",null,o(s.tempItem.user.tel),1),t("td",null,o(s.tempItem.user.address),1)])])])):u("",!0),t("div",wt,[w(t("input",{type:"checkbox",class:"form-check-input me-3",id:"paid","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempItem.is_paid=e)},null,512),[[x,s.tempItem.is_paid]]),xt])]),t("div",It,[Pt,t("button",{type:"button",class:"btn btn-success",onClick:l[1]||(l[1]=e=>r.updatePaid(s.tempItem))},"儲存變更")])])])]),t("div",Ct,[t("div",Lt,[t("div",Mt,[Tt,Et,t("div",Vt,[Dt,t("button",{type:"button",class:"btn btn-danger",onClick:l[2]||(l[2]=(...e)=>r.deleteOrder&&r.deleteOrder(...e))},"確定")])])])]),t("div",Bt,[t("div",St,[t("strong",Ut,o(s.toastTitle),1),Ot]),t("div",Rt,o(s.toastContent),1)])],64)}const zt=T(V,[["render",At]]);export{zt as default};
