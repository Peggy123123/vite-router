import{M as k,T as M}from"./bootstrap.esm-l9cKv-78.js";import{p as C}from"./PaginationMode-mQ26RO6W.js";import{_ as E,c as l,b as v,a as t,F as r,f as u,t as a,i as p,j as w,l as x,r as I,o as n}from"./index-KAtS-7Bo.js";var T={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"peggy123",VITE_TEXT:"這是部署的環境",BASE_URL:"/vite-router/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_PATH:_}=T;let b=null,g=null,y=null;const V={data(){return{orders:[],currentPage:1,perpage:10,tempItem:{},isLoading:!0,fallPage:!1}},components:{pagination:C},methods:{getData(){const d=`${m}/api/${_}/admin/orders?page=${this.currentPage}`;this.isLoading=!0,this.$http.get(d).then(s=>{this.orders=s.data.orders,this.pagination=s.data.pagination,console.log(this.orders)}).catch(s=>{alert(s.response.data.message)}).finally(()=>{this.isLoading=!1})},updatePaid(d){const s=`${m}/api/${_}/admin/order/${d.id}`,f={is_paid:d.is_paid};this.isLoading=!0,this.$http.put(s,{data:f}).then(h=>{console.log(h),b.hide(),y.show()}).catch(h=>{alert(h.response.data.message)}).finally(()=>{this.isLoading=!1})},openModal(d,s){this.tempItem=d,console.log(this.tempItem),s==="edit"?b.show():s==="delete"&&g.show()},deleteOrder(){const d=`${m}/api/${_}/admin/order/${this.tempItem.id}`;this.isLoading=!0,this.$http.delete(d).then(s=>{console.log(s),g.hide(),this.getData()}).catch(s=>{alert(s.response.data.message)}).finally(()=>{this.isLoading=!1})},swichPage(d){this.currentPage=d}},computed:{totalPage(){return Math.ceil(this.orders.length/this.perpage)}},mounted(){const d=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=d,this.getData(),b=new k(document.getElementById("orderModal"),{keyboard:!1}),g=new k(document.getElementById("deleteModal"),{keyboard:!1}),y=new M(document.querySelector(".toast-paid")),console.log(y)}},D={class:"container"},S={class:"row"},B={class:"table mt-30 rounded align-middle text-center table-striped"},U=t("thead",null,[t("tr",{class:"table-dark"},[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col",width:"250"},"Email"),t("th",{scope:"col",width:"250"},"購買品項"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"是否付款"),t("th",{scope:"col"}),t("th",{scope:"col"})])],-1),O={key:0},A={scope:"row"},R={key:"product.id",class:"ps-0 mb-0"},j={class:"d-flex justify-content-between"},q={class:"pe-5 text-secondary"},H={class:"form-check form-switch"},N=["onUpdate:modelValue","onChange"],F={class:"form-check-label"},z={key:0,class:"text-success fw-bold"},X={key:1,class:"text-secondary"},G=["onClick"],J=["onClick"],K={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Q={class:"modal-dialog modal-lg"},W={class:"modal-content"},Y=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單詳細資訊"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Z={class:"modal-body"},$=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂單內容",-1),tt={key:0,class:"table mb-10"},et=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"訂單編號"),t("th",{scope:"col"},"下單日期"),t("th",{scope:"col"},"付款狀態"),t("th",{scope:"col"},"總金額")])],-1),st={scope:"row"},ot={key:0,class:"fw-bold text-success"},lt={key:1,class:"text-secondary"},at=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"購買商品",-1),nt={key:1,class:"table mb-10 align-middle"},dt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"品名"),t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"數量"),t("th",{scope:"col"},"金額")])],-1),it={scope:"row"},ct=["src"],rt=t("h2",{class:"fs-6 bg-dark text-white mb-0 py-3 text-center"},"訂購人資訊",-1),ht={key:2,class:"table"},pt=t("thead",null,[t("tr",{class:"table-light"},[t("th",{scope:"col"},"姓名"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"電話"),t("th",{scope:"col"},"地址")])],-1),ut={scope:"row"},mt={class:"form-check d-flex justify-content-end"},_t=t("label",{for:"paid"},"已付款",-1),bt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),yt={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ft={class:"modal-dialog modal-dialog-centered"},kt={class:"modal-content"},vt=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"刪除訂單"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),wt=t("div",{class:"modal-body"},[t("p",null,"是否確定刪除此訂單(刪除後將無法恢復)")],-1),xt={class:"modal-footer"},It=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),Pt=t("div",{class:"toast-paid",role:"alert","aria-live":"assertive","aria-atomic":"true"},[t("div",{class:"toast-header"},[t("strong",{class:"me-auto"},"Bootstrap"),t("small",null,"11 mins ago"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close"})]),t("div",{class:"toast-body"}," Hello, world! This is a toast message. ")],-1);function Lt(d,s,f,h,o,c){const P=I("VueLoading"),L=I("pagination");return n(),l(r,null,[v(P,{active:o.isLoading},null,8,["active"]),t("div",D,[t("div",S,[t("table",B,[U,t("tbody",null,[(n(!0),l(r,null,u(o.orders,e=>(n(),l(r,{key:e.id},[o.orders.length?(n(),l("tr",O,[t("td",A,a(new Date(e.create_at*1e3).toLocaleDateString()),1),t("td",null,a(e.user.email),1),t("td",null,[(n(!0),l(r,null,u(e.products,i=>(n(),l("ul",R,[t("li",j,[t("div",null,a(i.product.title),1),t("div",q,a(i.qty+i.product.unit),1)])]))),128))]),t("td",null,a(e.total)+" 元",1),t("td",null,[t("div",H,[w(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>e.is_paid=i,onChange:i=>c.updatePaid(e)},null,40,N),[[x,e.is_paid]]),t("label",F,[e.is_paid?(n(),l("span",z,"已付款")):(n(),l("span",X,"未付款"))])])]),t("td",null,[t("button",{type:"button",class:"btn btn-dark btn-sm",onClick:i=>c.openModal(e,"edit")},"檢視 ",8,G)]),t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>c.openModal(e,"delete")}," 刪除",8,J)])])):p("",!0)],64))),128))])])])]),v(L,{"total-Page":c.totalPage,"current-Page":o.currentPage,onSwichPage:d.switchPage},null,8,["total-Page","current-Page","onSwichPage"]),t("div",K,[t("div",Q,[t("div",W,[Y,t("div",Z,[$,o.tempItem?(n(),l("table",tt,[et,t("tbody",null,[t("tr",null,[t("th",st,a(o.tempItem.id),1),t("td",null,a(new Date(o.tempItem.create_at*1e3).toLocaleDateString()),1),t("td",null,[o.tempItem.is_paid?(n(),l("span",ot,"已付款")):(n(),l("span",lt,"尚未付款"))]),t("td",null,a(o.tempItem.total),1)])])])):p("",!0),at,o.tempItem?(n(),l("table",nt,[dt,t("tbody",null,[(n(!0),l(r,null,u(o.tempItem.products,e=>(n(),l("tr",{key:e.id},[t("td",it,a(e.product.title),1),t("td",null,[t("img",{src:e.product.imageUrl,alt:"product.product.title",width:"100"},null,8,ct)]),t("td",null,a(e.qty),1),t("td",null,a(e.total),1)]))),128))])])):p("",!0),rt,o.tempItem.user?(n(),l("table",ht,[pt,t("tbody",null,[t("tr",null,[t("td",ut,a(o.tempItem.user.name),1),t("td",null,a(o.tempItem.user.email),1),t("td",null,a(o.tempItem.user.tel),1),t("td",null,a(o.tempItem.user.address),1)])])])):p("",!0),t("div",mt,[w(t("input",{type:"checkbox",class:"form-check-input me-3",id:"paid","onUpdate:modelValue":s[0]||(s[0]=e=>o.tempItem.is_paid=e)},null,512),[[x,o.tempItem.is_paid]]),_t])]),t("div",bt,[gt,t("button",{type:"button",class:"btn btn-success",onClick:s[1]||(s[1]=e=>c.updatePaid(o.tempItem))},"儲存變更")])])])]),t("div",yt,[t("div",ft,[t("div",kt,[vt,wt,t("div",xt,[It,t("button",{type:"button",class:"btn btn-danger",onClick:s[2]||(s[2]=(...e)=>c.deleteOrder&&c.deleteOrder(...e))},"確定")])])])]),Pt],64)}const Tt=E(V,[["render",Lt]]);export{Tt as default};
